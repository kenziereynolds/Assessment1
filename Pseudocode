BEGIN

SECTION 1: CREATE DATABASE

CREATE Hospital_db

USE Hospital_db

SECTION 2: CREATE TABLES

CREATE TABLE Hospitals
	ADD Hospital_ID
	ADD Name
	ADD Address
	ADD Size
	ADD Type
	ADD Accreditation_status
	SET Hospital_ID AS PRIMARY KEY
	
CREATE TABLE Doctors
	ADD Person_ID
	ADD Name
	ADD Date_of_birth
	ADD Address
	ADD Role
	ADD Hospital_ID
	SET Person_ID AS PRIMARY KEY
	SET Hospital_ID AS FOREIGN KEY REFERENCES Hospitals.Hospital_id

CREATE TABLE Patients
	ADD Person_ID
	ADD Name
	ADD Date_of_birth
	ADD Address
	ADD Role
	ADD Doctor_ID
	SET Person_ID AS PRIMARY KEY
	SET Doctor_ID AS FOREIGN KEY REFERENCES Doctors.Person_ID
	
CREATE TABLE Prescriptions
	ADD Prescription_ID
	ADD Patient_ID
	ADD Doctor_ID
	ADD medication
	ADD prescription_date
	SET prescription_id AS PRIMARY KEY
	SET patient_id AS FOREIGN KEY REFERENCES Patients.Person_ID
	SET doctor_id AS FOREIGN KEY REFERENCES Doctors.Person_ID
	
SECTION 3: LOAD DATA

LOAD hospitals.csv INTO Hospitals
LOAD doctors.csv INTO Doctors
LOAD patients.csv INTO Patients
LOAD prescriptions.csv INTO Prescriptions
VERIFY row count for each table

SECTION 4: QUERIES

QUERY 1:
	
	INPUT Hospital_ID
	
	FOR each doctor IN Doctors
		IF Doctors.Hospital_ID = Hospital_ID
			OUTPUT Doctors.Name, Doctors.Person_ID
		END IF
	END FOR
	
QUERY 2:

	INPUT Patient_ID
	
	CREATE empty list Patient_Prescriptions

	FOR each prescription IN Prescriptions 
		IF Prescriptions.Patient_ID = Patient_ID
			ADD prescription TO Patient_Prescriptions
		END IF
	END FOR

	SORT Patient_Prescriptions BY Prescriptions.Prescription_date ASCENDING
	
	OUTPUT Patient_Prescriptions

QUERY 3:

	INPUT Doctor_ID
	
	FOR each prescription in Prescriptions
		IF Prescriptions.Doctor_ID = Doctor_ID
			OUTPUT Prescriptions.Prescription_ID,
						Prescriptions.Medication,
						Prescriptions.Prescription_date
		END IF
	END FOR
	
QUERY 4:

	INPUT Name, Date_of_birth, Address, Role, Doctor_ID
	
	GENERATE new_patient_id
	
	CREATE new_patient RECORD
	SET new_patient.Person_ID = new_patient_id
	SET new_patient.Name = Name
	SET new_patient.Date_of_birth = Date_of_birth
	SET new_patient.Address = Address
	SET new_patient.Role = Role
	SET new_patient.Doctor_ID = Doctor_ID
	
	ADD new_patient to Patients
	
QUERY 5:

	CREATE empty dictionary doctor_count
	
	FOR each prescription IN Prescriptions
		IF Prescriptions.Doctor_ID NOT IN doctor_count
			SET doctor_count[Prescriptions.Doctor_ID] TO 1
		ELSE
			INCREMENT doctor_count[Prescriptions.Doctor_ID] BY 1
		END IF
	END FOR
	
	FIND Doctor_ID WITH MAXIMUM value IN doctor_count
	
	OUTPUT Doctor_ID
	
QUERY 6:

	SET largest_size = 0
	SET largest_Hospital_ID = null
	
	FOR each hospital IN Hospitals
		IF hospital.Size > largest_size
			SET largest_size = hospital.Size
			SET largest_Hospital_ID = hospital.Hospital_ID
		END IF
	END FOR
	
	FOR each doctor IN Doctors
		IF doctor.Hospital_ID = largest_Hospital_ID
			OUTPUT doctor.Name, doctor.Person_ID
		END IF
	END FOR
	
END
